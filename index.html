<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>GIS 라이트</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5f253bed8a8966a66fc9076b662663fd&libraries=services&autoload=false"></script>
<link rel="stylesheet" href="https://hamancctv.github.io/2/style.css" />

<style>
html,body{height:100%;margin:0;}
#container{position:relative;height:100%;overflow:hidden;}
#mapWrapper{position:relative;width:100%;height:100%;z-index:1;}
#map{width:100%;height:100%;}
#rvWrapper{position:absolute;inset:0;display:none;z-index:0;}
#roadview{width:100%;height:100%;}
.view_roadview #rvWrapper{display:block;z-index:1;}
.view_roadview #mapWrapper{
  position:absolute;left:8px;bottom:8px;width:26%;height:26%;
  min-width:200px;min-height:150px;border:2px solid #ccc;border-radius:8px;
  background:#fff;z-index:2;box-shadow:0 8px 24px rgba(0,0,0,.2);
}
#close{position:absolute;top:8px;left:8px;padding:6px;background:#fff;
  border:1px solid #c8c8c8;border-radius:6px;cursor:pointer;z-index:3;box-shadow:0 1px #888;}
#close .img{display:block;width:14px;height:14px;
  background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/rv_close.png) no-repeat;}
.toolbar{position:fixed;top:60px;left:10px;display:flex;flex-direction:column;gap:8px;z-index:10;}
.btn-satellite,#roadviewControl{
  width:40px;height:40px;display:inline-flex;align-items:center;justify-content:center;
  border:1px solid #ccc;border-radius:8px;background:#fff;color:#555;cursor:pointer;
  transition:all .2s ease;box-sizing:border-box;
}
.btn-satellite:hover,#roadviewControl:hover{box-shadow:0 3px 12px rgba(0,0,0,.12);}
.btn-satellite.selected{border-color:#007aff;box-shadow:0 0 0 2px rgba(0,122,255,.15) inset;color:#007aff;}
.btn-satellite svg{width:18px;height:18px;display:block;}
.btn-satellite svg circle{fill:currentColor;}
#roadviewControl.active{
  border-color:#007aff;box-shadow:0 0 0 2px rgba(0,122,255,.15) inset;color:#007aff;
}
#roadviewControl::before{
  content:"";width:18px;height:18px;border-radius:50%;
  display:block;background:radial-gradient(#fff 0 28%,currentColor 29% 100%);
}

/* 제안창/입력창 z-index 상단 고정 */
.gx-suggest-root{z-index:99999!important;}
#btnGroupMST,#btnDistance,#roadviewControl,#btnSatellite{z-index:99998!important;}
</style>
</head>

<body>
<div id="container">
  <div id="mapWrapper">
    <div id="map"></div>
    <div class="toolbar">
      <button id="btnSatellite" class="btn-satellite" title="위성뷰">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/></svg>
      </button>
      <button id="roadviewControl" title="로드뷰"></button>
    </div>
  </div>
  <div id="rvWrapper">
    <div id="roadview"></div>
    <div id="close" title="로드뷰 닫기"><span class="img"></span></div>
  </div>
</div>

<!-- 외부 스크립트 -->
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script src="https://hamancctv.github.io/2/drawGroupLinesMST.js"></script>
<script src="https://hamancctv.github.io/2/btnDistance.js"></script>
<script src="https://hamancctv.github.io/2/markers-handler.js"></script>

<!-- ✅ 안정판 search-suggest.js -->
<script>
(function () {
  console.log("[search-suggest] loaded v2025-10-stable-original");
  const CSS = `
    .gx-suggest-root{position:absolute;top:8px;left:50%;transform:translateX(-50%);
      display:flex;flex-direction:column;align-items:stretch;width:min(520px,90vw);
      z-index:99999;font-family:inherit;}
    .gx-suggest-search{display:flex;gap:8px;align-items:center;}
    .gx-suggest-search input{flex:1;height:40px;padding:0 12px;border:1px solid #ccc;
      border-radius:10px;background:#fff;font-size:14px;outline:none;
      transition:border .2s,box-shadow .2s;}
    .gx-suggest-search input:focus{border-color:#4a90e2;box-shadow:0 0 0 2px rgba(74,144,226,.2);}
    .gx-suggest-box{position:absolute;top:48px;left:50%;transform:translateX(-50%);
      width:min(520px,90vw);background:#fff;border:1px solid #ccc;border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,.1);max-height:45vh;overflow-y:auto;z-index:99998;}
    .gx-suggest-item{padding:6px 12px;cursor:pointer;font-size:14px;transition:background .15s;}
    .gx-suggest-item:hover,.gx-suggest-item.active{background:#f0f4ff;}
    .gx-suggest-item .gx-badges{float:right;opacity:.6;font-size:12px;}
  `;
  const st=document.createElement("style");st.textContent=CSS;document.head.appendChild(st);

  window.initSuggestUI=function(opt={}){
    const parent=opt.parent||document.body,data=Array.isArray(opt.data)?opt.data:[],
      map=opt.map,getMarkers=opt.getMarkers||(()=>window.markers||[]),
      badges=opt.badges||[];
    const root=document.createElement("div");
    root.className="gx-suggest-root";
    root.innerHTML=`<div class="gx-suggest-search"><input type="text" placeholder="검색..." autocomplete="off"/></div><div class="gx-suggest-box" style="display:none;"></div>`;
    parent.appendChild(root);
    const input=root.querySelector("input"),box=root.querySelector(".gx-suggest-box");
    let current=[],selIndex=-1;
    const CHO=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    const getCho=s=>{let r="";for(let c of s){const n=c.charCodeAt(0)-44032;if(n>=0&&n<=11171)r+=CHO[Math.floor(n/588)];else r+=c;}return r;};
    const normalize=s=>(s||"").toString().trim().replace(/\s+/g,"").toLowerCase();
    const filterData=q=>{
      const nq=normalize(q),nqCho=getCho(nq);
      return data.filter(it=>{
        const name=normalize(it.name||it.name1||it.searchName),nameCho=getCho(name);
        return name.includes(nq)||nameCho.includes(nqCho);
      });
    };
    function render(list){
      box.innerHTML="";
      list.forEach((it,i)=>{
        const d=document.createElement("div");
        d.className="gx-suggest-item";
        d.innerHTML=`<span>${it.name||it.name1||it.searchName}</span>`+(badges.length?`<span class="gx-badges">${badges.map(b=>it[b]||"").filter(Boolean).join(" ")}</span>`:"");
        d.addEventListener("click",()=>choose(i));box.appendChild(d);
      });
      box.style.display=list.length?"block":"none";
    }
    function choose(i){
      const it=current[i];if(!it)return;
      input.value=it.name||it.name1||it.searchName;box.style.display="none";
      if(map&&it.lat&&it.lng){
        const latlng=new kakao.maps.LatLng(it.lat,it.lng);map.setCenter(latlng);map.setLevel(3);
      }
      const markers=getMarkers();
      for(const m of markers){
        if(m.content===it.name||m.searchName===it.name||m.name===it.name){
          kakao.maps.event.trigger(m,"click");break;
        }
      }
    }
    input.addEventListener("input",()=>{
      const q=(input.value||"").trim();
      if(!q){box.style.display="none";return;}
      const list=filterData(q);current=list;render(list);
    });
    input.addEventListener("keydown",e=>{
      if(box.style.display==="none")return;
      if(e.key==="ArrowDown"){selIndex=(selIndex+1)%current.length;updateSel();e.preventDefault();}
      else if(e.key==="ArrowUp"){selIndex=(selIndex-1+current.length)%current.length;updateSel();e.preventDefault();}
      else if(e.key==="Enter"){if(selIndex>=0)choose(selIndex);e.preventDefault();}
    });
    function updateSel(){const items=box.querySelectorAll(".gx-suggest-item");items.forEach((it,i)=>it.classList.toggle("active",i===selIndex));}
    input.addEventListener("focus",()=>{if(current.length)box.style.display="block";});
    document.addEventListener("mousedown",e=>{if(!root.contains(e.target))box.style.display="none";});
    console.log("[search-suggest] ready");
  };
})();
</script>

<script>
kakao.maps.load(function(){
  const center = new kakao.maps.LatLng(35.2725308711779,128.406307024695);
  const map = new kakao.maps.Map(document.getElementById("map"), { center, level:4 });
  if (typeof initSuggestUI === 'function') {
    initSuggestUI({
      map,
      data: window.SEL_SUGGEST || [],
      parent: document.getElementById("mapWrapper"),
      getMarkers: () => window.markers,
      badges: ["line","enclosure","address","ip","group"],
      hideOnRoadview:false
    });
  }
});
</script>
</body>
</html>
