<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>GIS 라이트</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

<!-- Kakao Maps SDK -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5f253bed8a8966a66fc9076b662663fd&libraries=services&autoload=false"></script>

<link rel="stylesheet" href="https://hamancctv.github.io/2/style.css" />

<style>
  html,body{height:100%;margin:0;}
  #container{position:relative;height:100%;overflow:hidden;}
  #mapWrapper{position:relative;width:100%;height:100%;z-index:1;}
  #map{width:100%;height:100%;}

  /* 좌측 툴바 */
  .toolbar{position:fixed;top:60px;left:10px;display:flex;flex-direction:column;gap:8px;z-index:10;}

  /* 위성뷰 버튼 */
  .btn-satellite{
    width:40px;height:40px;
    display:inline-flex;align-items:center;justify-content:center;
    border:1px solid #ccc;border-radius:8px;background:#fff;color:#555;
    cursor:pointer;transition:all .2s ease;box-sizing:border-box;
  }
  .btn-satellite:hover{box-shadow:0 3px 12px rgba(0,0,0,.12);}
  .btn-satellite.selected{border-color:#007aff;color:#007aff;box-shadow:0 0 0 2px rgba(0,122,255,.15) inset;}

  /* 로드뷰 버튼 */
  #roadviewControl{
    width:40px;height:40px;
    display:inline-flex;align-items:center;justify-content:center;
    border:1px solid #ccc;border-radius:8px;background:#fff;color:#555;
    cursor:pointer;transition:all .2s ease;box-sizing:border-box;
  }
  #roadviewControl:hover{box-shadow:0 3px 12px rgba(0,0,0,.12);}
  #roadviewControl.active{border-color:#007aff;color:#007aff;box-shadow:0 0 0 2px rgba(0,122,255,.15) inset;}
  #roadviewControl::before{
    content:"";width:18px;height:18px;border-radius:50%;
    display:block;background:radial-gradient(#fff 0 28%,currentColor 29% 100%);
  }

  /* 로드뷰 미니맵 */
  #rvWrapper{position:absolute;inset:0;display:none;z-index:0;}
  #roadview{width:100%;height:100%;}
  .view_roadview #rvWrapper{display:block;z-index:1;}
  .view_roadview #mapWrapper{
    position:absolute;left:8px;bottom:8px;
    width:26%;height:26%;
    min-width:200px;min-height:150px;
    border:2px solid #ccc;border-radius:8px;background:#fff;z-index:2;
    box-shadow:0 8px 24px rgba(0,0,0,.2);
  }

  /* === 완전 무시모드 === */
  body.interaction-locked .overlay-hover,
  body.interaction-locked [class*="overlay"],
  body.interaction-locked [class*="Overlay"],
  body.interaction-locked [class*="marker"],
  body.interaction-locked [class*="Marker"]{
    pointer-events:none !important;
    cursor:default !important;
  }
</style>
</head>
<body>
  <div id="container">
    <div id="mapWrapper">
      <div id="map"></div>
      <div class="toolbar">
        <button id="btnSatellite" class="btn-satellite" title="위성뷰">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/></svg>
        </button>
        <button id="roadviewControl" title="로드뷰"></button>
      </div>
    </div>
    <div id="rvWrapper"><div id="roadview"></div></div>
  </div>

  <!-- 공통 스크립트 -->
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
  <script src="https://hamancctv.github.io/2/sel_suggest.js"></script>

  <!-- ✅ 인터랙션 제어 (잠금 + 마커 완전무시) -->
  <script>
    window.__interactionLock=false;
    window.isInteractionLocked=()=>window.__interactionLock===true;
    window.setInteractionLock=function(state){
      window.__interactionLock=!!state;
      document.body.classList.toggle('interaction-locked',!!state);
      console.log(`[interactionLock] ${state?"LOCKED":"UNLOCKED"}`);
      window.setMarkerInteractivity(!state);
    };

    // ✅ 마커 상호작용 전체 토글
    window.setMarkerInteractivity=function(enabled){
      if(!window.markers)return;
      window.markers.forEach(m=>{
        try{m.setClickable(enabled);}catch(_){}
        try{
          const el=m.__overlay?.getContent?.();
          if(el)el.style.pointerEvents=enabled?"auto":"none";
        }catch(_){}
      });
      console.log(`[marker-interactive] ${enabled?"ENABLED":"DISABLED"}`);
    };
  </script>

  <!-- 외부 스크립트 -->
  <script src="https://hamancctv.github.io/2/markers-handler.js"></script>
  <script src="https://hamancctv.github.io/2/search-suggest.js"></script>
  <script src="https://hamancctv.github.io/2/drawGroupLinesMST.js"></script>
  <script src="https://hamancctv.github.io/2/btnDistance.js"></script>

  <script>
  kakao.maps.load(function(){
    const center=new kakao.maps.LatLng(35.2725308711779,128.406307024695);
    const map=new kakao.maps.Map(document.getElementById("map"),{center,level:4});
    window.map=map;

    const btnRV=document.getElementById("roadviewControl");
    const btnSat=document.getElementById("btnSatellite");
    const rvClient=new kakao.maps.RoadviewClient();
    const rv=new kakao.maps.Roadview(document.getElementById("roadview"));
    let overlayOn=false;

    /* === 로드뷰 토글 === */
    function toggleRoadview(){
      if(!overlayOn){
        overlayOn=true;
        btnRV.classList.add("active");
        setInteractionLock(true);
        map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
      }else{
        overlayOn=false;
        btnRV.classList.remove("active");
        setInteractionLock(false);
        map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
      }
    }
    btnRV.addEventListener("click",toggleRoadview);

    /* === 위성뷰 토글 === */
    btnSat.addEventListener("click",()=>{
      if(map.getMapTypeId()===kakao.maps.MapTypeId.ROADMAP){
        map.setMapTypeId(kakao.maps.MapTypeId.HYBRID);
        btnSat.classList.add("selected");
      }else{
        map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
        btnSat.classList.remove("selected");
      }
    });

    /* === 마커 생성 === */
    if(window.SEL_SUGGEST&&typeof initMarkers==="function"){
      const positions=window.SEL_SUGGEST.map(it=>({
        latlng:new kakao.maps.LatLng(it.lat,it.lng),
        content:it.name1||it.name||""
      }));
      initMarkers(map,positions);
    }

    /* === 검색창 === */
    if(typeof initSuggestUI==="function"){
      initSuggestUI({
        map,
        data:window.SEL_SUGGEST||[],
        parent:document.getElementById("mapWrapper"),
        getMarkers:()=>window.markers,
        badges:["group","line","address"]
      });
    }
  });
  </script>
</body>
</html>
