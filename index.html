<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>GIS 라이트</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

<!-- Kakao Maps SDK -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5f253bed8a8966a66fc9076b662663fd&libraries=services&autoload=false"></script>

<!-- ✅ 공용 포인터 차단 레이어 -->
<script src="https://hamancctv.github.io/2/input-shield.js"></script>

<!-- 기존 스타일 -->
<link rel="stylesheet" href="https://hamancctv.github.io/2/style.css" />

<style>
  html, body { height:100%; margin:0; }
  #container { position:relative; height:100%; overflow:hidden; }
  #mapWrapper { position:relative; width:100%; height:100%; z-index:1; }
  #map { width:100%; height:100%; }

  /* === 툴바 === */
  .toolbar {
    position: fixed;
    top: 60px; left: 10px;
    display: flex; flex-direction: column; gap: 8px;
    z-index: 10;
  }
  .toolbar button {
    width: 42px; height: 42px;
    display:flex; align-items:center; justify-content:center;
    font-size:22px; border:1px solid #ccc; border-radius:8px;
    background:#fff; cursor:pointer; transition:all .2s;
  }
  .toolbar button.active{ border-color:#007aff; color:#007aff; box-shadow:0 0 0 2px rgba(0,122,255,.15) inset; }

  /* ... (오빠가 올린 스타일 그대로 유지) ... */
</style>
</head>
<body>
  <div id="container">
    <div id="mapWrapper">
      <div id="map"></div>
      <div class="toolbar">
        <button id="btnSatellite" class="btn-satellite" title="위성뷰">🌐</button>
        <button id="roadviewControl" title="로드뷰">🚗</button>
        <button id="btnDistance" title="거리재기">📏</button>
        <button id="btnGroupMST" title="그룹연결">🧩</button>
      </div>
      <div class="rv-resizer" aria-hidden="true"></div>
    </div>
    <div id="rvWrapper"><div id="roadview"></div></div>
  </div>

  <!-- 기존 JS 유지 -->
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
  <script src="https://hamancctv.github.io/2/sel_suggest.js"></script>
  <script src="https://hamancctv.github.io/2/markers-handler.js"></script>
  <script src="https://hamancctv.github.io/2/search-suggest.js"></script>
  <script src="https://hamancctv.github.io/2/drawGroupLinesMST.js"></script>
  <script src="https://hamancctv.github.io/2/btnDistance.js"></script>

  <script>
  /* 🔸 전역 인터랙션 잠금 */
  window.__interactionLock = false;
  window.isInteractionLocked = () => window.__interactionLock === true;
  window.setInteractionLock = (s) => { window.__interactionLock = !!s; console.log(`[lock] ${s}`); };

  /* 🔹 로드뷰 토글 (InputShield 연동) */
  function toggleOverlay(active){
    const btn = document.getElementById('roadviewControl');
    if(active){
      setInteractionLock(true);
      InputShield.enable("roadview");
      btn.classList.add('active');
      map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
      console.log("[로드뷰] ON - shield enabled");
    } else {
      setInteractionLock(false);
      InputShield.disable();
      btn.classList.remove('active');
      map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
      console.log("[로드뷰] OFF - shield disabled");
    }
  }

  /* 🔹 거리재기 버튼 인터락 감지 */
  const distanceBtn = document.getElementById("btnDistance");
  const obs = new MutationObserver(() => {
    const on = distanceBtn.classList.contains("active");
    if (on) InputShield.enable("measure");
    else if (!overlayOn) InputShield.disable();
  });
  obs.observe(distanceBtn, { attributes:true, attributeFilter:["class"] });

  /* ✅ 지도 초기화 */
  kakao.maps.load(function(){
    const center = new kakao.maps.LatLng(35.2725308711779, 128.406307024695);
    map = new kakao.maps.Map(document.getElementById('map'), { center, level:4 });
    map.setMaxLevel(9);
    rvClient = new kakao.maps.RoadviewClient();
    rv = new kakao.maps.Roadview(document.getElementById('roadview'));
    document.getElementById('roadviewControl').addEventListener('click', ()=> toggleOverlay(!overlayOn));
  });
  </script>
</body>
</html>
