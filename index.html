<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>GIS ëª¨ë°”ì¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="https://hamancctv.github.io/2/favicon.ico" sizes="32x32"/>
  <link rel="stylesheet" href="style.css"> <!-- ğŸ‘‰ ë¡œë“œë·° ì œì™¸í•œ ê¸°ì¡´ ìŠ¤íƒ€ì¼ -->
</head>
<body>
  <div id="alert-overlay"><div id="alert-message"></div></div>

  <div id="container">
    <!-- ë¡œë“œë·° ì˜ì—­ -->
    <div id="rvWrapper">
      <div id="roadview" style="width:100%;height:100%;"></div>
      <div id="close" title="ë¡œë“œë·°ë‹«ê¸°" onclick="closeRoadview()"><span class="img"></span></div>
    </div>

    <!-- ì§€ë„ ì˜ì—­ -->
    <div id="mapWrapper">
      <div id="map" style="width:100%;height:100%"></div>
      <div id="roadviewControl" onclick="setRoadviewRoad()"></div>

      <!-- ê²€ìƒ‰ì°½ -->
      <div class="gx-suggest-search">
        <input type="search" class="gx-input" placeholder="ì˜ˆ) ã…ã…‡ã„±ã…‚ã„±ã……, ã„·032, ì‹œì„¤ëª…â€¦" autocomplete="off" />
        <button type="button" class="gx-btn">ê²€ìƒ‰</button>
      </div>
      <div class="gx-suggest-box"></div>
    </div>
  </div>

  <!-- SDK & ì™¸ë¶€ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KEY&libraries=services,clusterer,drawing&autoload=false"></script>
  <script src="https://code.jquery.com/jquery-3.6.1.js"></script>

  <!-- ì™¸ë¶€ ìœ í‹¸ -->
  <script src="sel_suggest.js"></script>
  <script src="drawGroupLinesMST.js"></script>
  <script src="btnDistance.js"></script>
  <script src="markers-handler.js"></script>
  <script src="search-suggest.js"></script>
  <script src="roadview.js"></script> <!-- âœ… ë¡œë“œë·° ì „ìš© -->

  <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
  kakao.maps.load(function () {
    const mapCenter = new kakao.maps.LatLng(35.2725308711779,128.406307024695);
    const map = new kakao.maps.Map(document.getElementById('map'),{center:mapCenter,level:4});
    map.setMaxLevel(9); 
    window.map = map;

    // ===== ë§ˆì»¤ ìƒì„± =====
    const raw=(window.SEL_SUGGEST||[]).map(it=>{
      const lat=parseFloat(it.lat),lng=parseFloat(it.lng);
      if(!isFinite(lat)||!isFinite(lng))return null;
      return{latlng:new kakao.maps.LatLng(lat,lng),content:it.name1||it.name,searchName:it.name2||it.name,group:it.line||null};
    }).filter(Boolean);
    const unique=new Map();
    for(const p of raw){
      const key=p.latlng.getLat()+","+p.latlng.getLng();
      if(!unique.has(key))unique.set(key,p);
    }
    const finalPositions=[...unique.values()];
    if(window.initMarkers) initMarkers(map,finalPositions);

    // ===== ê²€ìƒ‰ì°½ ì´ˆê¸°í™” =====
    if (window.initSuggestUI) {
      initSuggestUI({
        map,
        data: window.SEL_SUGGEST,
        parent: document.getElementById('mapWrapper'),
        getMarkers: () => window.markers,
        badges: ['line','encloser','addr','ip'],
        maxItems: 30,
        chooseOnEnter: true,
        openOnFocus: true
      });
    }

    // ===== íšŒì„  í† ê¸€ =====
    const btn=document.getElementById("toggle_group");
    if(window.drawGroupLinesMST){
      btn.addEventListener("click",()=>{
        drawGroupLinesMST(map);
        btn.classList.toggle("selected_btn");
      });
    }

    // âœ… ë¡œë“œë·° ì‹¤í–‰
    if(window.initRoadview){
      initRoadview(map,mapCenter);
    }
  });
  </script>
</body>
</html>
