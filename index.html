<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>GIS 라이트</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

<!-- Kakao Maps SDK -->
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5f253bed8a8966a66fc9076b662663fd&libraries=services&autoload=false"></script>

<!-- 기본 스타일 -->
<link rel="stylesheet" href="https://hamancctv.github.io/2/style.css" />

<style>
  html, body { height:100%; margin:0; }
  #container { position:relative; height:100%; overflow:hidden; }
  #mapWrapper { position:relative; width:100%; height:100%; z-index:1; }
  #map { width:100%; height:100%; }

  /* 로드뷰 */
  #rvWrapper { position:absolute; inset:0; display:none; z-index:0; }
  #roadview  { width:100%; height:100%; }
  .view_roadview #rvWrapper { display:block; z-index:1; }
  .view_roadview #mapWrapper {
    position:absolute; left:8px; bottom:8px;
    width:26%; height:26%;
    min-width:200px; min-height:150px;
    border:2px solid #ccc; border-radius:8px; background:#fff; z-index:2;
    box-shadow:0 8px 24px rgba(0,0,0,.2);
  }

  /* 닫기 버튼 */
  #close {
    position:absolute; top:8px; left:8px;
    padding:6px; background:#fff; border:1px solid #c8c8c8; border-radius:6px;
    cursor:pointer; z-index:3; box-shadow:0 1px #888;
  }
  #close .img {
    display:block; width:14px; height:14px;
    background:url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/rv_close.png) no-repeat;
  }

  /* 툴바 */
  .toolbar { position:fixed; top:60px; left:10px; display:flex; flex-direction:column; gap:8px; z-index:10; }

  .btn-satellite {
    width:40px; height:40px;
    display:inline-flex; align-items:center; justify-content:center;
    border:1px solid #ccc; border-radius:8px; background:#fff; color:#555;
    cursor:pointer; transition:all .2s ease; box-sizing:border-box;
  }
  .btn-satellite:hover { box-shadow:0 3px 12px rgba(0,0,0,.12); }
  .btn-satellite.selected { border-color:#007aff; color:#007aff; }

  #roadviewControl{
    width:40px; height:40px;
    display:inline-flex; align-items:center; justify-content:center;
    cursor:pointer;
    border:1px solid #ccc; border-radius:8px; background:#fff !important;
    color:#555; transition:all .2s ease;
  }
  #roadviewControl.active{ border-color:#007aff; color:#007aff; }

  /* 거리재기/로드뷰 중 마커 포인터 완전 차단 */
  body.interaction-locked .marker,
  body.interaction-locked [class*="overlay"],
  body.interaction-locked .overlay-hover {
    pointer-events:none !important;
    cursor:default !important;
  }

  /* 로드뷰 동동이 */
  .MapWalker {position:absolute; margin:-26px 0 0 -51px; cursor:grab; z-index:2147483647;}
  .MapWalker.dragging{ cursor:grabbing; }
  .MapWalker .figure {
    position:absolute; width:25px; left:38px; top:-2px; height:39px;
    background:url(https://t1.daumcdn.net/localimg/localimages/07/2018/pc/roadview_minimap_wk_2018.png) -298px -114px no-repeat;
  }
</style>
</head>
<body>
  <div id="container">
    <div id="mapWrapper">
      <div id="map"></div>

      <div class="toolbar">
        <button id="btnSatellite" class="btn-satellite" title="위성뷰">🛰️</button>
        <button id="roadviewControl" title="로드뷰">👁️</button>
      </div>
    </div>
    <div id="rvWrapper">
      <div id="roadview"></div>
    </div>
  </div>

  <!-- 전역 스크립트 -->
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
  <script src="https://hamancctv.github.io/2/sel_suggest.js"></script>

  <!-- ✅ 인터랙션 잠금 제어 -->
  <script>
    window.__interactionLock = false;
    window.isInteractionLocked = () => window.__interactionLock === true;
    window.setInteractionLock = state => {
      window.__interactionLock = !!state;
      document.body.classList.toggle('interaction-locked', !!state);
      console.log(`[interactionLock] ${state ? "LOCKED" : "UNLOCKED"}`);
    };
  </script>

  <!-- ✅ 주요 스크립트 -->
  <script src="https://hamancctv.github.io/2/markers-handler.js"></script>
  <script src="https://hamancctv.github.io/2/search-suggest.js"></script>
  <script src="https://hamancctv.github.io/2/drawGroupLinesMST.js"></script>
  <script src="https://hamancctv.github.io/2/btnDistance.js"></script>

  <!-- ✅ 지도 초기화 -->
  <script>
  kakao.maps.load(function(){
    const center = new kakao.maps.LatLng(35.2725308711779,128.406307024695);
    const map = new kakao.maps.Map(document.getElementById('map'), { center, level:4 });
    window.map = map;

    const btnRV = document.getElementById('roadviewControl');
    const btnSat = document.getElementById('btnSatellite');
    const rvClient = new kakao.maps.RoadviewClient();
    const rv = new kakao.maps.Roadview(document.getElementById('roadview'));
    let overlayOn = false;

    function toggleRoadview() {
      if (!overlayOn) {
        overlayOn = true;
        btnRV.classList.add('active');
        setInteractionLock(true);
        map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
      } else {
        overlayOn = false;
        btnRV.classList.remove('active');
        setInteractionLock(false);
        map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
      }
    }

    btnRV.addEventListener('click', toggleRoadview);
    btnSat.addEventListener('click', ()=>{
      if(map.getMapTypeId()===kakao.maps.MapTypeId.ROADMAP){
        map.setMapTypeId(kakao.maps.MapTypeId.HYBRID);
        btnSat.classList.add('selected');
      } else {
        map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
        btnSat.classList.remove('selected');
      }
    });

    // 마커 불러오기
    if(window.SEL_SUGGEST && typeof initMarkers==='function'){
      const positions = window.SEL_SUGGEST.map(it=>({
        latlng:new kakao.maps.LatLng(it.lat,it.lng),
        content:it.name1||it.name||''
      }));
      initMarkers(map,positions);
    }

    // 검색창
    if(typeof initSuggestUI==='function'){
      initSuggestUI({
        map,
        data:window.SEL_SUGGEST||[],
        parent:document.getElementById('mapWrapper'),
        getMarkers:()=>window.markers,
        badges:['group','line','address']
      });
    }
  });
  </script>
</body>
</html>
